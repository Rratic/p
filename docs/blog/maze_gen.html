<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>博客/迷宫生成算法 - Rratic</title>
	<meta name="tURL" id="tURL" content="../../">
	<meta name="description" content="博客/迷宫生成算法 - Rratic">
	<script src="../../extra/info.js"></script>
	<link id="theme-href" rel="stylesheet" type="text/css" href="../../css/light.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../extra/main.js"></script>
	<link rel="stylesheet" type="text/css" href="../../css/general.css">
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/fontawesome.min.css">
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/solid.min.css">
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/brands.min.css">
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.4/katex.min.css">
</head>
<body>
	<div id="documenter">
		<nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">Rratic</span></div><ul class="docs-menu"></ul></nav>
		<div class="docs-main">
			<header class="docs-navbar">
				<nav class="breadcrumb"><ul><li class="is-active">博客 / 迷宫生成算法</li></ul></nav>
				<div class="docs-right"><a class='docs-edit-link' href='https://github.com/Rratic/mine/tree/master/docs/blog/maze_gen.md' target='_blank'><span class='docs-label is-hidden-touch'>编辑此页面</span></a>
					<a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="设置"></a>
					<a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a>
				</div>
			</header>
			<article class="content"><h1 id='header-迷宫生成算法'>迷宫生成算法<a class='docs-heading-anchor-permalink'></a></h1><h2 id='header-1'>1<a class='docs-heading-anchor-permalink'></a></h2><p>思路：</p><div data-lang='jl'><div class='codeblock-header'></div><pre class='codeblock-body language-jl'><code>初始全部为墙
随机选一格，标记一下，加入列表
while 列表非空
    随机从列表中挑一格
    从列表中删除
    如果已标记，删除跑路
    标记
    if 周围墙数≤1
        将周围4面墙加入列表
    end
end
</code></pre></div><br /><p>上代码</p><div data-lang='cpp'><div class='codeblock-header'></div><pre class='codeblock-body language-cpp'><code>#include&lt;bits/stdc++.h&gt;
using namespace std;
#define isin(x,y) (x&gt;=0&amp;&amp;y&gt;=0&amp;&amp;x&lt;m&amp;&amp;y&lt;n)
template&lt;unsigned short l=15,unsigned short w=15&gt;
void prim(unsigned short maze_len,unsigned short maze_wid,array&lt;array&lt;unsigned short,l&gt;,w&gt;&amp;a){
    int m=maze_len,n=maze_wid;
    short mox[4]={0,0,1,-1},moy[4]={1,-1,0,0};
    vector&lt;pair&lt;unsigned short,unsigned short&gt;&gt;li;
    bool was[21][21];
    for(int i=0;i&lt;m;++i)for(int j=0;j&lt;n;++j){a[i][j]='#';was[i][j]=0;}
    unsigned short stx,sty,enx,eny;
    stx=rand()%m;sty=rand()%n;
    a[stx][sty]='.';li.push_back(make_pair(stx,sty));
    while(!li.empty()){
        auto rr=rand()%li.size();
        auto r=li[rr];
        li.erase(li.begin()+rr);
        if(was[r.first][r.second])continue;
        was[r.first][r.second]=1;
        unsigned short c=0;
        for(int i=0;i&lt;4;++i)if(isin(r.first+mox[i],r.second+moy[i])&amp;&amp;a[r.first+mox[i]][r.second+moy[i]]=='.')++c;
        if(c&lt;=1){
            a[r.first][r.second]='.';
            for(int i=0;i&lt;4;++i){
                if(!was[r.first+mox[i]][r.second+moy[i]]&amp;&amp;isin(r.first+mox[i],r.second+moy[i])){
                    li.push_back(make_pair(r.first+mox[i],r.second+moy[i]));
                }
            }
        }
        enx=r.first;
        eny=r.second;
    }
    a[stx][sty]='@';
    a[enx][eny]='%';
}
int main(){
    //srand(123456);
    array&lt;array&lt;unsigned short,15&gt;,15&gt;a;
    prim&lt;15,15&gt;(15,15,a);
    for(int i=0;i&lt;15;++i){
        for(int j=0;j&lt;15;++j){
            cout&lt;&lt;char(a[i][j]);
        }
        cout&lt;&lt;'\n';
    }
}
</code></pre></div><br /><p>栗子：</p><div data-lang='plain'><div class='codeblock-header'></div><pre class='codeblock-body language-plain'><code>..#.#..#.##.#%.
.##..#.#.....#.
...#.#...###...
#.#...#.##..###
#..#.#..#..#...
..##...#.#..#.#
#...#.##...#...
..##.....##.#.#
#..##.##..#.#..
..#.#.#.##..#.#
#.........#.#..
..###.#.#.....#
#....##..#.##..
.@#.#...#....#.
.#..#.##..#.#..
</code></pre></div><br /><h2 id='header-2'>2<a class='docs-heading-anchor-permalink'></a></h2><div data-lang='jl'><div class='codeblock-header'></div><pre class='codeblock-body language-jl'><code>macro rd(l, r)
	return :(wrand_even_q(world, $l, $r))
end
function _infmaze_zone_maze(c::Chunk, world, lx, ly, rx, ry, delta)
	if rx-lx&lt;delta || ry-ly&lt;delta
		c.blks[lx:rx, ly:ry] .= B_Air()
		return
	end
	mx=@rd lx+1 rx-1
	my=@rd ly+1 ry-1
	c.blks[lx:rx, my] .= B_StarRock()
	c.blks[mx, ly:ry] .= B_StarRock()
	_infmaze_zone_maze(c, world, lx, ly, mx-1, my-1, delta)
	_infmaze_zone_maze(c, world, mx+1, ly, rx, my-1, delta)
	_infmaze_zone_maze(c, world, lx, my+1, mx-1, ry, delta)
	_infmaze_zone_maze(c, world, mx+1, my+1, rx, ry, delta)
	dir=wrand_q(world)&amp;0x3
	if dir==0x0
		c.blks[mx, @rd(my+1, ry)]=B_Air()
		c.blks[@rd(lx, mx-1), my]=B_Air()
		c.blks[@rd(mx+1, rx), my]=B_Air()
	elseif dir==0x1
		c.blks[mx, @rd(ly, my-1)]=B_Air()
		c.blks[@rd(lx, mx-1), my]=B_Air()
		c.blks[@rd(mx+1, rx), my]=B_Air()
	elseif dir==0x2
		c.blks[mx, @rd(ly, my-1)]=B_Air()
		c.blks[mx, @rd(my+1, ry)]=B_Air()
		c.blks[@rd(mx+1, rx), my]=B_Air()
	else
		c.blks[mx, @rd(ly, my-1)]=B_Air()
		c.blks[mx, @rd(my+1, ry)]=B_Air()
		c.blks[@rd(lx, mx-1), my]=B_Air()
	end
end
function (gen::InfMazeGenerator)(c::Chunk, world, idx, idy)
	c.blks[1, 1:64] .= B_StarRock()
	c.blks[2:64, 1] .= B_StarRock()
	wsrand(world, xor(idx&lt;&lt;15+idy, world.seed))
	distance = idx^2+idy^2
	_infmaze_zone_maze(c, world, 2, 2, 64, 64,
		gen.plain || distance&gt;25 ? 0 :
		distance&lt;11 ? 4 : 2)
	b1 = (wrand_q(world)&amp;0x1f)&lt;&lt;1
	b2 = (wrand_q(world)&amp;0x1f)&lt;&lt;1
	c.blks[1, b1] = B_Air()
	c.blks[b2, 1] = B_Air()
end
</code></pre></div><br /></article>
			<nav class="docs-footer"><a class="docs-footer-prevpage" href="index.html">« 索引</a><div class='flexbox-break'></div><p class='footer-message'>Powered by <a href='https://github.com/JuliaRoadmap/DoctreePages.jl'>DoctreePages.jl</a> and its dependencies.</p></nav>
			
			<div id='rocket' onclick='boom()'></div>
		</div>
	</div>
</body>
</html>
